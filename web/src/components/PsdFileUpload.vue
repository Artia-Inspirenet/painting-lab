<template>
  <div class="drag container bg-light">
    <div class="p-4">
      <div class="form-group">
        <label for="author-name">Author Name</label>
        <input type="text" id="author-name" class="form-control" v-model="info.author.name" placeholder="조석">
      </div>
      <div class="form-group">
        <label for="work-name">Work Name</label>
        <input type="text" id="work-name" class="form-control" v-model="info.work.title" placeholder="마음의 소리">
      </div>
      <div class="form-group">
        <label for="episode-name">Episode Name</label>
        <input type="text" id="episode-name" class="form-control" v-model="info.episode.title" placeholder="643화">
      </div>
    </div>
    <div class="upload">
      <ul class="list-unstyled p-5" v-if="files.length">
        <li v-for="file in files" :key="file.id">
          <span>{{file.name}}</span> -
          <span>{{file.size | formatSize}}</span> -
          <span v-if="file.error">{{file.error}}</span>
          <span v-else-if="file.success">success</span>
          <span v-else-if="file.active">active</span>
          <span v-else-if="file.active">active</span>
          <span v-else></span>
        </li>
      </ul>
      <ul v-else>
        <div class="text-center p-5"
          v-if="$refs.upload && $refs.upload.dropActive">
          <h4>Ya! Drop them!</h4>
        </div>
        <div class="text-center p-5"
          v-else>
          <h4>Drag files here!</h4>
        </div>
      </ul>


      <div class="btn">
        <file-upload
          class="btn btn-primary"
          post-action="api/uploads/"
          :headers="{'X-CSRFToken': this.csrfTk }"
          :data="{ author: info.author.name, work: info.work.title, episode: info.episode.title }"
          :multiple="true"
          :drop="true"
          :drop-directory="true"
          name="psdfile"
          v-model="files"
          ref="upload">
          <i class="fa fa-plus"></i>
          Select files
        </file-upload>
        <button
          class="btn btn-success"
          v-if="!$refs.upload || !$refs.upload.active"
          @click.prevent="$refs.upload.active = true">
          <i class="fa fa-arrow-up" aria-hidden="true"></i>
          Start Upload
        </button>
        <button
          class="btn btn-danger"
          v-else @click.prevent="$refs.upload.active = false">
          <i class="fa fa-stop" aria-hidden="true"></i>
          Stop Upload
        </button>
      </div>
    </div>
  </div>
</template>

<script>
import FileUpload from 'vue-upload-component'
import axios from 'axios'


export default {
  name: 'PsdFileUpload',
  props: {
    csrfTk: String,
  },
  components: {
    FileUpload,
  },
  data: function () {
    return {
      files: [],
      info: {
        author: {
          name: ''
        },
        work: {
          title: '',
        },
        episode: {
          title: '',
        },
      },
      lookupdb: {
        author: [{
          id: 0,
          name: ''
        }],
        work: [{
          id: 0,
          title: ''
        }],
        episode: [{
          id: 0,
          title: ''
        }],
      }
    }
  },
  methods: {
    consoleTest: function () {
      console.log('Hello, Hi.')
    },
    onLoadAuthor: function () {
      axios.get('/api/author').then( function (response) {
        console.log(response);
        this.lookupdb.author = response.data.author;
      });
    },
    onLoadWork: function () {
      axios.get('/api/work').then( function (response) {
        console.log(response);
        this.lookupdb.work = response.data.work;
      });
    },
    onLoadEpisode: function () {
      axios.get('/api/episode').then( function (response) {
        console.log(response);
        this.lookupdb.episode = response.data.episode;
      });
    },
  },
  beforeMount: function () {
    this.consoleTest();
    this.onLoadAuthor();
    this.onLoadWork();
    this.onLoadEpisode();
  },
}
</script>

<style scoped>
.drag .btn {
  margin: 0.5rem;
}

/*

.drag .drop-active {
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  position: fixed;
  z-index: 9999;
  opacity: .6;
  text-align: center;
  background: #000;
}

.drag .drop-active h3 {
  margin: -.5em 0 0;
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
  font-size: 40px;
  color: #fff;
  padding: 0;
}
*/
div div.drop-zone {
  width: 100%;
  height: 100px;
  border: 1px #ababab dashed;
  margin: 50px auto;
}

div.drop-zone p {
  text-align: center;
  line-height: 100px;
  margin: 0;
  padding: 0;
}

.drag {
  border: 1px #ababab dashed;
}

</style>
